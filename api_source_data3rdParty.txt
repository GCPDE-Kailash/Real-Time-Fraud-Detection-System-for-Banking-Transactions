from flask import Flask, request, jsonify
from google.cloud import pubsub_v1
import json

app = Flask(__name__)
publisher = pubsub_v1.PublisherClient()
project_id = "YOUR_PROJECT_ID"
topic_id = "YOUR_TOPIC_ID"
topic_path = publisher.topic_path(project_id, topic_id)

@app.route('/webhook', methods=['POST'])
def webhook():
    data = request.get_json()
    if data:
        message = json.dumps(data).encode('utf-8')
        future = publisher.publish(topic_path, message)
        return jsonify({"message": "Data received", "message_id": future.result()}), 200
    else:
        return jsonify({"error": "No data received"}), 400

if __name__ == "__main__":
    app.run(port=5000, debug=True)
